<!DOCTYPE html>
&nbsp;&nbsp;&nbsp;
<html lang="en">
<head>
<script>
version = 8
</script>

  <!-- Basic Page Needs
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta charset="utf-8">
  <title>Google Assistant</title>
  <meta name="author" content="jottocraft">

  <!-- CSS
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <!-- Fluid UI -->
  <link href="icons.css" rel="stylesheet">
  <link type="text/css" rel="stylesheet" href="fluid.css" media="screen,projection"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <script>if (typeof module === 'object') {window.module = module; module = undefined;}</script>
  <script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
  <script>if (window.module) module = window.module;</script>
  <script type="text/javascript" src="fluid.js"></script>
  <script>if (window.module) module = window.module;</script>
  <script>
  setTimeout(function(){
       $(".button-collapse").sideNav();
 }, 100);
  </script>

</head>
<body>
  <script>
      const {shell} = require('electron');
      const fs = require("fs");
      var session = require('electron').remote.session;
var ses = session.fromPartition('persist:name');
  function python() {
shell.openItem('install-python.exe');
  }
  function modules() {
    shell.openItem('install-modules.bat');
  }
  function device() {
    shell.openItem('register-device.bat')
  }
  function opencmd() {
    shell.openItem('run.bat');
  }
  function debugs() {
    shell.openItem('run-debug.bat');
  }
  function installservice() {
    var data = fs.readFileSync('pythondir.txt');
    var str = data.toString();
    console.log(str);
    pythondir = str.slice(0, -12);
    oldd = "pushtotalk.py"
    neww = pythondir + 'Lib\\site-packages\\googlesamples\\assistant\\grpc\\pushtotalk.py'
    try {fs.unlink(neww, iferr)} catch(err) {    console.log("fs error:  " + err) }
    fs.createReadStream(oldd).pipe(fs.createWriteStream(neww));
    document.getElementById("serinstallstats").innerHTML = "Complete";
  }
  function exsetup() {
    installservice();
    shell.openItem('update.bat')
  }
  cookieval = null;
  function getCookie(name) {
    cookieval = null;
    var value = {
        name: name // the request must have this format to search the cookie.
    };
    ses.cookies.get(value, function(error, cookies) {
      cookieval = cookies[0].value; // the value saved on the cookie
    })
}
function setCookie(name, data) {
    var expiration = new Date();
    var hour = expiration.getHours();
    hour = hour + 6;
    expiration.setHours(hour);
    ses.cookies.set({
        url: "https://tp.js.org", //the url of the cookie.
        name: name, // a name to identify it.
        value: data, // the value that you want to save
        expirationDate: expiration.getTime()
    }, function(error) {
        /*console.log(error);*/
    });
}
function opmenu(menu) {
  if (navigator.onLine || menu == "nointernet") {
  var a = document.getElementById("assistant");
  a.style.display = "none";
  var b = document.getElementById("setup");
  b.style.display = "none";
  var c = document.getElementById("debug");
  c.style.display = "none";
  var c = document.getElementById("finishupdate");
  c.style.display = "none";
  var d = document.getElementById("update");
  d.style.display = "none";
  var e = document.getElementById("nointernet");
  e.style.display = "none";
  var f = document.getElementById(menu);
  f.style.display = "block";
} else {
  opmenu("nointernet")
}
}

  </script>
  <script>
  getCookie("setup");
  setTimeout(function(){
  hassetup = cookieval
   if (cookieval == null) {
     opmenu('setup');
   } else {
     var dataaa = fs.readFileSync('version.txt');
     prevv = Number(dataaa.toString());
     console.log(prevv + "prev")
     console.log(version + "v")
   if (prevv < version && fs.existsSync("version.txt")) {
     console.log("cool update")
     opmenu("finishupdate");
   } else {
     opmenu("assistant");
     opencmd();
     fs.writeFile('version.txt', version, (err) => {
     if (err) throw err;
     console.log('The file has been saved!');
   });
   }
   }
  }, 100);
      if (!fs.existsSync("listen.txt")) {
        fs.writeFile('listen.txt', 'off', (err) => {
        if (err) throw err;
        console.log('The file has been saved!');
      });
}
if (!fs.existsSync("utrans.txt")) {
  fs.writeFile('utrans.txt', '', (err) => {
  if (err) throw err;
  console.log('The file has been saved!');
});
}
if (!fs.existsSync("rtrans.txt")) {
  fs.writeFile('rtrans.txt', '', (err) => {
  if (err) throw err;
  console.log('The file has been saved!');
});
}
if (!fs.existsSync("version.txt")) {
  fs.writeFile('version.txt', version, (err) => {
  if (err) throw err;
  console.log('The file has been saved!');
});
}
  function utrans() {
    var data = fs.readFileSync('utrans.txt');
    $("#chatcurrent .utransloc").html(data.toString());
  }
  function rtrans() {
    var dataa = fs.readFileSync('rtrans.txt');
    $("#chatcurrent .rtransloc").html(dataa.toString());
  }
  function micupdate() {
    var dataaa = fs.readFileSync('listen.txt');
    aaa = dataaa.toString();
    if (aaa == "off") {
      document.getElementById("micicon").innerHTML = "mic_none"
    } else {
      if (aaa == "listen") {
        document.getElementById("micicon").innerHTML = "mic"
      }
    }
  }
  function start() {
    opmenu("assistant");
    setCookie("setup", "true");
    fs.writeFile('version.txt', version, (err) => {
    if (err) throw err;
    console.log('The file has been saved!');
  });
  }
  function textbox() {
    var r = $("#chatcurrent .rtransloc").text();
    var u = $("#chatcurrent .utransloc").text();
    if (r == "") {
      $("#chatcurrent .rtransloc").hide()
    } else {
      $("#chatcurrent .rtransloc").show()
    }
    if (u == "") {
      $("#chatcurrent .utransloc").hide()
    } else {
      $("#chatcurrent .utransloc").show()
    }
  }
  </script>
  <script>
  setTimeout(function(){
  function refresh() {
    utrans();
    rtrans();
    micupdate();
    textbox();
    setTimeout(function(){ refresh(); }, 100);
  }
  refresh();
}, 200);
function listen() {
  document.getElementById("micicon").innerHTML = "mic"
  var isactive = $("#chatcurrent .rtransloc").text();
  if (isactive !== "") {
    document.getElementById("chathistory").innerHTML = document.getElementById("chatcurrent").innerHTML;
    fs.writeFile('rtrans.txt', '', (err) => {
    if (err) throw err;
    console.log('The file has been saved!');
  });
    fs.writeFile('utrans.txt', '', (err) => {
    if (err) throw err;
    console.log('The file has been saved!');
  });
  }
  fs.writeFile('listen.txt', 'listen', (err) => {
  if (err) throw err;
  console.log('The file has been saved!');
});
}
function setuppg(num) {
  numm = num - 1
  if (num !== 1) {var x = document.getElementById("setup" + numm);}
  var y = document.getElementById("setup" + num);
  if (num !== 1) {x.style.display = "none";}
  y.style.display = "block";
  if (num == 1) {
    opmenu('setup');
    i = 2
    while (i < 6) {
    console.log(i)
    var x = document.getElementById("setup" + i);
    x.style.display = "none";
    i = i + 1
  }
  }
  }
  </script>
  <script>

  </script>
  <script src="https://www.gstatic.com/firebasejs/4.8.1/firebase.js"></script>
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyDtU13gRzRg7OLuUd9GNgPFf6y05ooxr5U",
    authDomain: "premium-episode-182223.firebaseapp.com",
    databaseURL: "https://premium-episode-182223.firebaseio.com",
    projectId: "premium-episode-182223",
    storageBucket: "premium-episode-182223.appspot.com",
    messagingSenderId: "616649436562"
  };
  firebase.initializeApp(config);
  console.log("hi")
var firebaseTpRef = firebase.database().ref().child("latest");
firebaseTpRef.on('value', function(datasnapshot){
    var v = Number(datasnapshot.val());
    var vnon = datasnapshot.val();
    console.log(v + "   has been detected")
    if (v > version) {
      console.log("looks like this is news")
      i = v
      console.log("oh no...")
      function checknlog() {
      if (i > version) {
      var tmpfireRef = firebase.database().ref().child(i + "-log");
      tmpfireRef.on('value', function(snapshot){
      loggg = snapshot.val();
      document.getElementById("logss").innerHTML = document.getElementById("logss").innerHTML + "<br><br>" + loggg
      console.log("done")
      i = i - 1
      checknlog();
      });
    }
  }
  checknlog();
  var x = document.getElementById("updatebtn");
  x.style.display = "block";
    } else {
      var x = document.getElementById("updatebtn");
      x.style.display = "none";
    }
  });
</script>
  <style>
  .footer {
    position: absolute;
       bottom:0;
       margin-left: auto;
      margin-right: auto;
       width:100%;
}
body:not(.dark) .utransloc {
  background-color:#e6e8ed;
}
body.dark .utransloc {
  background-color:#23272A;
}
body:not(.dark) .rtransloc {
  border-color: #d7dae0;
}
body.dark .rtransloc {
  border-color: #16181a;
}
  </style>
  <script>

  const updateOnLineStatus = () => {
    if (navigator.onLine) {
      if (hassetup !== null) {
      opmenu("assistant");
    } else {
      setuppg(1);
    }
    } else {
      opmenu("nointernet");
    }
  }

  window.addEventListener('online', updateOnLineStatus)
  window.addEventListener('offline', updateOnLineStatus)
function resetdata() {
  ses.clearStorageData([], function (data) {
    console.log(data);
});
}
  </script>

  <!-- Primary Page Layout
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
      <ul id="slide-out" class="side-nav">
         <li><div class="user-view">
           <a href="#!user"><img style="width:64px;height:64x;" src="assistant.png"></a>
            <h5>Google Assistant</h5>
           <span class="email">v0.0.8 Developer Preview</span>
         </div></li>
         <li><a href="#!" onclick="opmenu('assistant');"><i class="material-icons">mic</i>Assistant</a></li>
         <li><a href="#!" onclick="setuppg(1);" id="configure"><i class="material-icons">build</i>Setup</a></li>
         <li id="updatebtn" style="display:none"><a href="#" onclick="opmenu('update');"><i class="material-icons">system_update_alt</i>Update</a></li>
         <li><a href="#" onclick="opmenu('debug');"><i class="material-icons">bug_report</i>Debug</a></li>
         <li><div class="divider"></div></li>
         <li><a class="subheader">Assistant</a></li>
         <li><a href="#" onclick="shell.openExternal('https://myactivity.google.com/myactivity')"><i class="material-icons">replay</i>Activity</a></li>
         <li><a href="#" onclick="shell.openExternal('https://assistant.google.com/intl/en_us/platforms/phones/')"><i class="material-icons">phonelink_setup</i>Settings</a></li>
       </ul>
       <div style="margin-left:5px;margin-right:5px;" class="row">
       <a href="#" data-activates="slide-out" class="button-collapse btn-flat" style="margin-top:5px;"><i class="material-icons">menu</i></a>
       <div class="right">
       <a href="#" onclick="shell.openItem('stop.bat')"  class="btn-flat" style="margin-top:5px;"><i class="material-icons">blur_off</i></a>
     </div>
   </div>
  <div class="container" id="setup" style="margin-top:10%;display:none">
    <img src="assistant.png" style="width:150px;height:150px;"></img>
    <br>
    <div id="setup1">
        <h4>Setup your Google Assistant</h4>
        <br>
        <p>Google Assistant is now on your PC</p>
        <br>
        <div>
          <button onclick="setuppg(2);">Setup</button>
        </div>
        <br><br><br>
      </div>
      <div id="setup2" style="display:none;">
        <h4>Install Python</h4>
        <br>
        <p>Make sure to install with the system path and pip. If you have python 2, you may have to upgrade.</p>
        <br>
        <button class="btn waves-effect" onclick="python();">Install Python 3</button>
        <br>
        <br>
        <button class="btn waves-effect" onclick="modules();">Install Python Modules</button>
        <br><br><br><br>
        <div>
          <button onclick="setuppg(3);">Next</button>
        </div>
        <br><br>
        </div>
        <div id="setup3" style="display:none;">
          <br><br>
          <h4>Join the Group</h4>
          <p>You will have to join the Google Group to get access to the Google Cloud project, which allows you to use the assistant. Nothing will be posted, and you won't recive any emails.</p>
          <button onclick="shell.openExternal('https://groups.google.com/forum/#!forum/google-assistant-for-windows')">Join the group</button>
          <br><br>
        <h4>Register your device</h4>
        <br>
        <button class="btn waves-effect" onclick="device();">Register device with Google</button>
        <br>
        <br>
        <h4>Assistant App</h4>
        <p>Your PC registers as a device in the Assistant app. Follow the instructions <a herf="#" onclick="shell.openExternal('https://developers.google.com/assistant/sdk/guides/assistant-settings')">here</a> to change settings for your PC's assistant.</p>
        <br><br>
        <div>
          <button onclick="setuppg(4);">Next</button>
        </div>
        <br><br>
      </div>
      <div id="setup4" style="display:none;">
        <br>
        <h4>Service</h4>
        <br>
        <p>The service will automatically start and hide itself so it's out of your way. If you want to close the service, use the icon at the right top corner.</p>
        <button id="serinstallstats" onclick="installservice();">Install the service</button>
        <br><br>
        <button class="btn waves-effect" onclick="debugs();">Test</button>
        <br>
        <p>Close the test once you've confirmed that it doesn't throw an error</p>
        <br><br><br>
        <div>
          <button onclick="setuppg(5);">Next</button>
        </div>
        <br><br>
      </div>
      <div id="setup5" style="display:none;">
        <h5>Working?</h5>
        <br>
        <p>Great! Have fun using the Google Assistant! Note that some things will not work because of the SDK's limitations. You can always setup again if anything breaks using the menu at the left top corner.</p>
        <br>
        <button class="btn waves-effect" onclick="start();">Start using the app</button>
        <br><br><br>
        <h5>Not working?</h5>
        <p>Please run the service in debug mode and post a screenshot of your error on GitHub so I can debug and fix it.</p>
        <button onclick="opmenu('debug');" style="background-color:red;color:white;">Debug</button>
        <br>
        <br><br>
      </div>
  </div>

  <!-- Assistant -->
  <div class="container footer" id="assistant" style="margin-top:10%;display:none;width:100%;overflow:auto;z-index:-50000 !important;">
    <br>
        <br><br>
        <div id="chathistory">
        </div>
        <br><br>
        <div id="chatcurrent">
        <div class="utransloc" style="border-radius:50px;padding-left:10px;padding-right:10px;padding-top:5px;padding-bottom:5px;align-items:right;text-align:right;float:right;" class="right">Test</div>
        <br><br>
        <img src="assistant.png" style="width:50px;height:50px;"></img>
        <div class="rtransloc" style="border-radius:30px;border-style: solid;border-width: medium;display: inline-block;padding-left:10px;padding-right:10px;padding-top:5px;padding-bottom:5px;"></div>
      </div>
        <br><br><br>
        <div class="center">
        <button class="btn-flat waves-effect btn-large" onclick="listen();"><i id="micicon" class="material-icons">mic_none</i></button>
        </div>
        <br>
  </div>
  <div class="container" id="debug" style="display:none">
    <br>
    <h4>Debug Menu</h4>
    <br>
    <button onclick="shell.openExternal('https://github.com/jottocraft/google-assistant/issues/new')" style="background-color:#2f662b;color:white;">Report a bug</button>
    <br>
    <br>
    <br>
    <button onclick="debugs();">Service Debug Mode</button>
    <br>
    <br>
    <button onclick="shell.openItem('d-top.bat');">Keep assistant on top</button>
    <br><br>
    <button onclick="shell.openItem('d-show.bat');">Show Service</button>
    <br><br>
    <button style="color:white;background-color:red;" onclick="resetdata()">Reset App Data</button>
  </div>
  <div class="container" id="nointernet" style="display:none">
    <br>
    <h4>No Internet Connection</h4>
    <br>
    <i class="large material-icons">signal_wifi_off</i>
    <br>
    <p>Connect to the internet to use the Google Assistant</p>
  </div>
  <div class="container" id="update" style="display:none">
    <br>
    <h4>Update</h4>
    <br>
    <p id="versiontxt">It looks like there's a new version ready</p>
    <p>Update Google Assistant for the latest bugfixes, features, and improvements</p>
    <br>
    <button onclick="shell.openExternal('https://github.com/jottocraft/google-assistant/releases')">Download the latest version</button>
    <br><br>
    <h5>Changelogs from all new versions</h5>
    <div id="logss">
    </div>
    <br>
  </div>
  <div class="container" id="finishupdate" style="display:none">
    <br>
    <h4>Finish updating</h4>
    <br>
    <p>Just click the button below to finish installing updates</p>
    <br>
    <button onclick="exsetup();">Finish Update</button>
    <br><br>
    <button onclick="start();">Complete</button>
    <br>
  </div>


<!-- End Document
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
</body>
</html>
